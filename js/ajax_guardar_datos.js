function guardar_datos(e){let a={},r="";for(let e=0;e<document.querySelectorAll("#actividad").length;e++)""!=document.querySelectorAll("#actividad")[e].value&&(r+=document.querySelectorAll("#actividad")[e].value+"|");if(console.log(r),a={apellido:document.querySelector("#apellido").value,nombre:document.querySelector("#nombre").value,foto_perfil:document.querySelector("#foto_base64").value,edad:document.querySelector("#edad").value,fecha_nac:document.querySelector("#fecha_nac").value,documento:document.querySelector("#documento").value,correo:document.querySelector("#correo").value,tel_alumno:document.querySelector("#tel_alumno").value,tel_fijo:document.querySelector("#tel_fijo").value,nacionalidad:document.querySelector("#nacionalidad").value,localidad:document.querySelector("#localidad").value,domicilio:document.querySelector("#domicilio").value,salud:document.querySelector("#salud").value,actividad:r,observacion_alumno:document.querySelector("#observacion_alumno").value},""==a.fecha_nac.trim()||""==a.apellido.trim()||""==a.nombre.trim())return alertify.alert("Carga de datos","Complete los datos obligatorios (*)");alertify.confirm("Carga de datos","Seguro que quiere guardar los datos de este alumno/a ?",(function(){fetch("ajax/ajax_guardar_datos.php",{method:"POST",body:JSON.stringify({alumno:a})}).then((e=>e.json())).then((function(e){""!=e.error&&alertify.alert("Carga de datos",e.error),e.respAlumno&&(alertify.success("Guardado correctamente"),setTimeout((function(){window.location.href="index.php"}),2e3))})).catch((function(e){console.log(e),alertify.alert("Carga de datos","Ocurrio un error al guardar los datos.")}))}),(function(){alertify.error("Cancelado")}))}function guardar_familiar(e){let a={};if(a={id_alumno:document.querySelector("#id_alumno").value,nom_ape:document.querySelector("#nom_ape").value,vinculo:document.querySelector("#vinculo").value,tel_familiar:document.querySelector("#tel_familiar").value,observacion_familiar:document.querySelector("#observacion_familiar").value},""==a.nom_ape.trim()||""==a.vinculo.trim()||""==a.tel_familiar.trim())return alertify.alert("Carga de familiares","Complete los datos obligatorios (*)");alertify.confirm("Carga de familiares","Seguro que quiere guardar los datos de este familiar ?",(function(){fetch("ajax/ajax_guardar_familiar.php",{method:"POST",body:JSON.stringify({familiar:a})}).then((e=>e.json())).then((function(e){e.respFamiliar&&(alertify.success("Guardado correctamente"),setTimeout((function(){location.reload()}),2e3))})).catch((function(e){console.log(e),alertify.alert("Carga de familiares","Ocurrio un error al guardar los datos.")}))}),(function(){alertify.error("Cancelado")}))}function guardar_vinculo(e){let a,r={};return r={nom_vinculo:document.querySelector("#nom_vinculo").value.trim(),id_alumno:document.querySelector("#id_alumno").value.trim(),nom_vinculo_nuevo:document.querySelector("#nom_vinculo_nuevo").value.trim()},"0"==r.id_alumno?alertify.alert("Carga de vinculos","Seleccione un alumno por favor."):""==r.nom_vinculo_nuevo&&"0"==r.nom_vinculo?alertify.alert("Carga de vinculos","Seleccione un vinculo familiar o si no esta escriba el nuevo vinculo."):""!=r.nom_vinculo_nuevo&&"0"!=r.nom_vinculo?alertify.alert("Carga de vinculos","Si el vinculo seleccionado es el correcto borre el nuevo vinculo escrito de lo contrario quite la seleccion."):(a=""==r.nom_vinculo_nuevo?r.nom_vinculo:r.nom_vinculo_nuevo,void alertify.confirm("Carga de vinculos","Seguro que quiere guardar a este alumno/a en la familia "+a+" ?",(function(){fetch("ajax/ajax_guardar_vinculo_actividades.php",{method:"POST",body:JSON.stringify({alumnos:r})}).then((e=>e.json())).then((function(e){Array.isArray(e.respVinculo)?alertify.error("El alumno/a ya esta vinculado a esa familia."):e.respVinculo&&(alertify.success("Guardado correctamente"),setTimeout((function(){location.reload()}),2e3))})).catch((function(e){console.log(e),alertify.alert("Carga de vinculos","Ocurrio un error al guardar los datos.")}))}),(function(){alertify.error("Cancelado")})))}function desvincular(e){let a={};return a={nom_vinculo:document.querySelector("#nom_vinculo").value.trim(),id_alumno:document.querySelector("#id_alumno").value.trim(),desvincular:"desvincular"},"0"==a.id_alumno?alertify.alert("Carga de vinculos","Seleccione un alumno por favor."):"0"==a.nom_vinculo?alertify.alert("Carga de vinculos","Seleccione un vinculo familiar."):void alertify.confirm("Carga de vinculos","Seguro que quiere desvincular a este alumno/a de la familia "+a.nom_vinculo+" ?",(function(){fetch("ajax/ajax_guardar_vinculo_actividades.php",{method:"POST",body:JSON.stringify({alumnos:a})}).then((e=>e.json())).then((function(e){Array.isArray(e.respVinculo)?alertify.error("El alumno/a no esta vinculado a esa familia."):e.respVinculo&&(alertify.success("Desvinculado correctamente"),setTimeout((function(){location.reload()}),2e3))})).catch((function(e){console.log(e),alertify.alert("Carga de vinculos","Ocurrio un error al guardar los datos.")}))}),(function(){alertify.error("Cancelado")}))}function datos_actividad(e){let a=document.querySelector("#id_actividad").value;if("0"==a.trim())return alertify.alert("Actividades","Seleccione una actividad.");document.querySelector("#agregar_nueva_actividad").checked=!1,document.querySelector("#guardar_actividad").disabled=!1,document.querySelector("#nueva_actividad").disabled=!0,fetch("ajax/ajax_guardar_vinculo_actividades.php",{method:"POST",body:JSON.stringify({id_actividad:a})}).then((e=>e.json())).then((function(e){console.log(e.respActividad[0]),document.querySelector("#cargar_actividad").innerHTML='<div class="form-group col-md-4 float-left">\n            <label for="exampleFormControlInput1">Actividad</label>\n            <input type="text" id="id_guardar_actividad" class="form-control" value="'+e.respActividad[0].actividad+'">\n        </div>\n        <div class="form-group col-md-2 float-left">\n            <label for="exampleFormControlInput1">Una vez</label>\n            <input type="number" id="id_guardar_una" class="form-control" value="'+e.respActividad[0].una_vez+'">\n        </div>\n        <div class="form-group col-md-2 float-left">\n            <label for="exampleFormControlInput1">Una vez efectivo</label>\n            <input type="number" id="id_guardar_una_efectivo" class="form-control" value="'+e.respActividad[0].una_vez_efec+'">\n        </div>\n        <div class="form-group col-md-2 float-left">\n            <label for="exampleFormControlInput1">Dos veces</label>\n            <input type="number" id="id_guardar_dos" class="form-control" value="'+e.respActividad[0].dos_veces+'">\n        </div>\n        <div class="form-group col-md-2 float-left">\n            <label for="exampleFormControlInput1">Dos veces efectivo</label>\n            <input type="number" id="id_guardar_dos_efectivo" class="form-control" value="'+e.respActividad[0].dos_veces_efec+'">\n        </div>'})).catch((function(e){console.log(e),alertify.alert("Actividades","Ocurrio un error al cargar los datos.")}))}function guardar_actividad(e){let a={},r=document.querySelector("#id_actividad").value;return 0==r&&"nueva_actividad"!=e.target.id?alertify.alert("Guardar actividad","Tiene que seleccionar una actividad."):(document.querySelector("#nueva_actividad").disabled=!1,document.querySelector("#guardar_actividad").disabled=!0,console.log(r),a={id_guardar_id:r,id_guardar_actividad:document.querySelector("#id_guardar_actividad").value,id_guardar_una:parseInt(document.querySelector("#id_guardar_una").value),id_guardar_una_efectivo:parseInt(document.querySelector("#id_guardar_una_efectivo").value),id_guardar_dos:parseInt(document.querySelector("#id_guardar_dos").value),id_guardar_dos_efectivo:parseInt(document.querySelector("#id_guardar_dos_efectivo").value)},""==a.id_guardar_actividad.trim()?alertify.alert("Guardar actividad","El campo actividad no puede quedar vacio."):isNaN(a.id_guardar_una)||isNaN(a.id_guardar_una_efectivo)||isNaN(a.id_guardar_dos)||isNaN(a.id_guardar_dos_efectivo)?alertify.alert("Guardar actividad","Uno de los precios    no es numerico.(Se admite solo numero,sin comas o puntos)"):void alertify.confirm("Guardar actividad","Seguro que quiere guardar esta actividad ?",(function(){fetch("ajax/ajax_guardar_vinculo_actividades.php",{method:"POST",body:JSON.stringify({guardar_actividad:a})}).then((e=>e.json())).then((function(e){e.respGuardarActividad&&(alertify.success("Guardado correctamente"),setTimeout((function(){location.reload()}),2e3))})).catch((function(e){console.log(e),alertify.alert("Carga de vinculos","Ocurrio un error al guardar los datos.")}))}),(function(){alertify.error("Cancelado")})))}function agregar_nueva_actividad(e){if(1!=e.target.checked)return document.querySelector("#cargar_actividad").innerHTML="",document.querySelector("#nueva_actividad").disabled=!0,void(document.querySelector("#guardar_actividad").disabled=!1);document.querySelector("#nueva_actividad").disabled=!1,document.querySelector("#guardar_actividad").disabled=!0,document.querySelector("#cargar_actividad").innerHTML='<div class="form-group col-md-4 float-left">\n        <label for="exampleFormControlInput1">Actividad</label>\n        <input type="text" id="id_guardar_actividad" class="form-control">\n    </div>\n    <div class="form-group col-md-2 float-left">\n        <label for="exampleFormControlInput1">Una vez</label>\n        <input type="number" id="id_guardar_una" class="form-control">\n    </div>\n    <div class="form-group col-md-2 float-left">\n        <label for="exampleFormControlInput1">Una vez efectivo</label>\n        <input type="number" id="id_guardar_una_efectivo" class="form-control">\n    </div>\n    <div class="form-group col-md-2 float-left">\n        <label for="exampleFormControlInput1">Dos veces</label>\n        <input type="number" id="id_guardar_dos" class="form-control">\n    </div>\n    <div class="form-group col-md-2 float-left">\n        <label for="exampleFormControlInput1">Dos veces efectivo</label>\n        <input type="number" id="id_guardar_dos_efectivo" class="form-control">\n    </div>'}function agregar_actividad(){let e=document.getElementsByTagName("input")[6].readOnly;e=1==e?"readonly":"",document.querySelector("#nueva_actividad").insertAdjacentHTML("beforeend",'<div class="form-group col-md-12 float-left">\n                <label>Nueva actividad</label>\n                <i class="bi bi-dash-circle-dotted eliminar_actividad" title="Eliminar actividad" id="eliminar_actividad"></i>\n                <input list="actividades" class="form-control" id="actividad" '+e+">        \n            </div>")}function eliminar_actividad(e){let a=e.target.parentElement;a.querySelector("label").textContent,a.parentNode.removeChild(a)}window.addEventListener("click",(function(e){"guardar_datos"==e.target.id&&guardar_datos(e),"eliminar_actividad"==e.target.id&&eliminar_actividad(e),"agregar_actividad"==e.target.id&&agregar_actividad(e),"guardar_familiar"==e.target.id&&guardar_familiar(e),"guardar_vinculo"==e.target.id&&guardar_vinculo(e),"desvincular"==e.target.id&&desvincular(e),"guardar_actividad"==e.target.id&&guardar_actividad(e),"agregar_nueva_actividad"==e.target.id&&agregar_nueva_actividad(e),"nueva_actividad"==e.target.id&&guardar_actividad(e)})),window.addEventListener("change",(function(e){"nom_vinculo"==e.target.id&&(document.querySelector("#nom_vinculo_nuevo").value=""),"id_actividad"==e.target.id&&datos_actividad(e)})),window.addEventListener("keyup",(function(e){"nom_vinculo_nuevo"==e.target.id&&(document.querySelector("#nom_vinculo").value="0")}));